syntax = "proto3";

package radarService;

option go_package = "gl.npo-its.ru/radar/proto-radar";

// Сервис для взаимодействия с радаром
service RadarService {
  // Выставление базовых настроек радара
  rpc SetDefaultParamsSensor(SetDefaultParamsSensorRequest) returns (StateSensorResponse);

  // Выставление/получение конкретного параметра сенсора
  //rpc ManageSensorParam(ManageSensorParamRequest) returns (ManageSensorParamResponse);

  // Выставление параметров Lane
  //rpc ManageLanes(ManageLanesRequest) returns (ManageLanesResponse);

  // Получение всех параметров радара
  rpc GetStateSensor(GetStateSensorRequest) returns (StateSensorResponse);

  // Комплексная настройка радара с полосами
  rpc SetParamSensor(SetParamSensorRequest) returns (SetParamSensorResponse);

  // Получение списка доступных сенсоров
  rpc GetAvailableSensors(GetAvailableSensorsRequest) returns (GetAvailableSensorsResponse);
}

message RadarWithLanes {
  string id = 1;
  string name = 2;
  double lat = 3;
  double lon = 4;
  repeated double coords = 5;    // массив float64
  float azimuth = 6;
  float angle = 7;
  double height = 8;
  string direction = 9;
  string address = 10;
  string ip = 11;
  string serial = 12;
  string model = 13;
  int32 waveform_selector = 14; // 100 waveform_selector (выбор формы сигнала) Значение: 1 (65 MHz / 96 RG) По умолчанию: 0 (145 MHz / 168 RG)
  int32 tx_power_selector = 15; // 104 (уровень мощности передатчика) Значение: 1 (высокая мощность) По умолчанию: 1
  repeated SensorLane lanes = 16;
  uint32 serial_number = 17;    // Добавленное поле: серийный номер
}

// Сообщение для SensorLane
message SensorLane {
  string id = 1;
  string name = 2;
  int32 direction = 3;
  repeated Point2D coords = 4;           // координаты полосы в плоской системе координат
  float width = 8;                       // Ширина полосы
  int32 number_lane = 9;                 // Номер полосы
}

message Point2D {
  double x = 1;
  double y = 2;
}

// Запрос на создание радара с полосами
message SetParamSensorRequest {
  RadarWithLanes radar = 1;
}

message SetParamSensorResponse {
  RadarWithLanes radar = 1;
}

// Запрос на получение списка доступных сенсоров
message GetAvailableSensorsRequest {
  // Пустой запрос, можно добавить фильтры в будущем
}

// Ответ со списком доступных сенсоров
message GetAvailableSensorsResponse {
  repeated AvailableSensor sensors = 1;
}

// Информация о доступном сенсоре
message AvailableSensor {
  uint32 serial_number = 1; // Серийный номер сенсора
  string ip = 2;           // IP адрес сенсора
  int32 port = 3;          // Порт сенсора
}

// Точка в 2D пространстве
//message Point {
//  double x = 1;
//  double y = 2;
//}

// Остальные сообщения остаются без изменений
message GetStateSensorRequest {
  uint32 serial_number = 1;
}

// Запрос на установку параметров сенсора
message SetDefaultParamsSensorRequest {
  uint32 serial_number = 1;
}

// Запрос на управление параметрами сенсора
//message ManageSensorParamRequest {
//  string sensor_id = 1;
//  string mode = 2; // "r" - чтение, "rw" - чтение/запись
//  repeated ParamState state = 3;
//}

// Состояние параметра
message ParamState {
  string param = 1;
  double value = 2;
}

// Ответ на управление параметрами сенсора
//message ManageSensorParamResponse {
//  string sensor_id = 1;
//  repeated ParamState state = 2;
//}

// Запрос на управление полосами
//message ManageLanesRequest {
//  string sensor_id = 1;
//  string mode = 2; // "r" - чтение, "rw" - чтение/запись
//  repeated LaneRequest lane = 3;
//}

// Запрос для одной полосы
message LaneRequest {
  int32 number = 1;
  int32 width = 2;
  int32 bidirectional = 3;
  repeated Coordinate coordinate = 4;
}

// Ответ на управление полосами
//message ManageLanesResponse {
//  string sensor_id = 1;
//  repeated LaneResponse lane = 2;
//}

// Ответ для одной полосы
message LaneResponse {
  int32 number = 1;
  int32 width = 2;
  int32 bidirectional = 3;
  repeated Coordinate coordinate = 4;
}

// Координата
message Coordinate {
  double x = 1;
  double y = 2;
}

// Полный ответ состояния сенсора
message StateSensorResponse {
  uint32 serial_number = 1;
  ConnectionParams connection_params = 2;
  SetParamSensorResponse params = 3;
}

// Параметры подключения
message ConnectionParams {
  string sensor_ip = 1;
  int32 sensor_port = 2;
}

// Основные параметры
//message Params {
//  double x = 1;
//  double y = 2;
//  double height = 3;
//  double xy_orientation = 4;
//  double xz_orientation = 5;
//  int32 waveform_selector = 6;
//  int32 tx_power_selector = 7;
//  map<int32, Line> lines = 8;
//}

// Линия/полоса
//message Line {
//  int32 width = 1;
//  int32 bidirectional = 2;
//  map<int32, Coordinate> coordinates = 3;
//}