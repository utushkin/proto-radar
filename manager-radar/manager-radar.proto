syntax = "proto3";

package radar;

option go_package = "gl.npo-its.ru/radar/proto-radar";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

message IdRequest {
  string id = 1; // Идентификатор радара
}

// Ответ сервиса
message IdResponse {
  string id = 1;           // UUID созданной/удалённой сущности
}

message Type {
  string id = 1;
  string full_name = 2;
}

// Структура радара
message Radar {
  string  id = 1; // Идентификатор радара
  string name = 2; // Название радара
  double lat = 3;
  double lon = 4;
  float azimuth = 5; // Азимут
  float angle = 6; // Угол наклона
  float height = 7; // Высота
  optional string direction = 8; // Направление
  string address = 9; // Адрес
  string ip = 10; // IP-адрес
  string serial = 11; // Серийный номер
  string model = 12; // Модель радара
}

// Ответ сервиса
message RadarResponse {
  Radar radar = 1; // Ответ с радаром (при создании или обновлении)
}
// Ответ сервиса
message RadarsResponse {
  repeated Radar radars = 1; // Ответ с массивом радаров (при получении всех)
}

// Запрос на создание радара
message CreateRadarRequest {
  Radar radar = 1; // Радар для создания
}

// Запрос на обновление радара
message UpdateRadarRequest {
  string id = 1; // Идентификатор радара
  Radar radar = 2; // Обновленные данные радара
}

message RecognitionsFilter {
  repeated string sensor_ids = 1;
  double heading_from = 2;
  double heading_to = 3;
  double length_from = 4;
  double length_to = 5;
  double speed_from = 6;
  double speed_to = 7;
  int64  date_from = 8;
  int64  date_to = 9;
  string sorting = 10;        // "asc" or "desc"
  string sorting_column = 11;
}

message GetTransportObjectInfoRequest {
  int64 page = 1; // номер страницы
  int64 pageSize = 2; // кол-во объектов на странице
  RecognitionsFilter filter = 3;
}

message TransportObjectInfo {
  string id = 1;
  string sensor_id = 2;
  string origin_id = 3;
  bytes coordinates = 4; // JSON-encoded координаты
  string color = 5;
  double speed = 6;
  double heading = 7;
  double length = 8;
  int64 date = 9;
  google.protobuf.Timestamp created_at = 10;
}

message GetTransportObjectInfoResponse {
  repeated TransportObjectInfo data = 1;
  int32 page = 2;
  int32 page_size = 3;
  int64 total_items = 4;
}

// Ответ с временными зонами
message TimeZonesResponse {
  repeated TimeZone time_zones = 1; // Список временных зон
}

message TimeZone {
  string id = 1;
  string full_name = 2;
  string time_zone = 3;
}

// Ответ с моделями радара
message RadarModelsResponse {
  repeated RadarModel models = 1; // Список моделей радара
}

// Структура модели радара
message RadarModel {
  string id = 1;       // Идентификатор модели
  string alias = 2;    // Алиас модели
  string model_name = 3; // Название модели
  string manufacturer = 4; // Производитель модели
}

message Device {
  string id = 1; // Идентификатор Пуида
  string name = 2; // Название Пуида
  string address = 3; // Адрес
  double lat = 4;  // Широта
  double lon = 5; // Долгота
  string serial = 6; // Серийный номер
  google.protobuf.Timestamp production_date = 7; // Дата производства
  optional string note = 8; // Примечание
}

message DeviceResponse {
  Device device = 1;
}

message UpdateDeviceRequest {
  Device device = 1;
}

message ExportTypeParam {
  string field = 1;
}

message ExportType {
  string id = 1;
  string full_name = 2;
  repeated ExportTypeParam parameters = 3;
}

message GetExportTypesResponse {
  repeated ExportType types = 1;
}

message GetExportStatusesResponse {
  repeated Type statuses = 1;
}

// Структура экспорта
message Export {
  string  id = 1;
  string name = 2;
  string export_type = 3 [json_name = "exportType"];
  int32 interval = 4;
  optional string host = 5;
  optional string port = 6;
  optional string login = 7;
  optional string password = 8;
  optional string queue = 9;
  optional string virtual_host = 10 [json_name = "virtualHost"];
  optional string routing_key = 11 [json_name = "routingKey"];
  optional string exchange = 12;
}

message ListExport {
  string  id = 1;
  string name = 2;
  string export_type = 3;
  string host = 4;
  string port = 5;
  bool export_on = 6;
}

message ExportEvent {
  string  id = 1;
  string  export_id = 2;
  int64 date = 3;
  string name = 4;
  int64 export_start_date = 5;
  int64 export_finish_date = 6;
  string export_status = 7;
}

message ExportsEventsFilter {
  repeated string export_ids = 1;
  repeated string statuses = 2;
  int64  export_start_date_from = 3;
  int64  export_start_date_to = 4;
}

message GetExportsEventsRequest {
  int64 page = 1; // номер страницы
  int64 pageSize = 2; // кол-во объектов на странице
  ExportsEventsFilter filter = 3;
}


message GetExportsEventsResponse {
  repeated ExportEvent exportsEvents = 1; 
  int64 page = 2;
  int64 page_size = 3;
  int64 total_items = 4;
}


message ExportResponse {
  Export export = 1; 
}

message ExportIdResponse {
  string exportId = 1;
}

message ExportsResponse {
  repeated ListExport exports = 1; 
}


message CreateExportRequest {
  Export export = 1; 
}


message UpdateExportRequest {
  Export export = 1; 
}


message ChangeExportStateRequest {
  string id = 1; 
  bool export_on = 2; 
}

message ChangeExportStateResponse {
  string id = 1; 
  bool export_on = 2; 
}

message Point {
  repeated double coords = 1;  // Всегда ровно 2 элемента: [x, y]
}

message PolylineCoords {
  repeated Point points = 1;  // [[x1,y1], [x2,y2], ...]
}

message ControlPoints {
  Point lengthStart = 1;    // [number, number]
  Point lengthEnd = 2;      // [number, number]
  Point widthStart = 3;     // [number, number]
  Point widthEnd = 4;       // [number, number]
  Point moveControl = 5;    // [number, number]
  Point curveControl = 6;   // [number, number]
}

message Lane {
  string  id = 1; // Идентификатор полосы
  string name = 2; // Название полосы
  string direction = 3; // Название полосы
  PolylineCoords coords = 4; // координаты полосы
  PolylineCoords arrowPoints = 5; // координаты стрелки
  ControlPoints controlPoints = 6; // точки для рисования полосы
  int32 width = 7; // Ширина полосы
}

message LaneResponse {
  Lane lane = 1; 
}


message LanesResponse {
  repeated Lane lanes = 1; 
}

message GetDirectionTypesResponse {
  repeated Type types = 1;
}


message LaneRequest {
  string id = 1; 
  string radarId = 2;
}

message CreateLaneRequest {
  string radarId = 1;
  Lane lane = 2;
}

message UpdateLaneRequest {
  string radarId = 1;
  Lane lane = 2;
}

service RadarService {
  rpc CreateRadar(CreateRadarRequest) returns (RadarResponse);
  rpc UpdateRadar(UpdateRadarRequest) returns (RadarResponse);
  rpc GetRadar(IdRequest) returns (RadarResponse);
  rpc GetAllRadars(google.protobuf.Empty) returns (RadarsResponse);
  rpc DeleteRadar(IdRequest) returns (RadarResponse);

  rpc GetTimeZones(google.protobuf.Empty) returns (TimeZonesResponse);
  rpc GetRadarModels(google.protobuf.Empty) returns (RadarModelsResponse);

  rpc GetDevice(google.protobuf.Empty) returns (DeviceResponse);
  rpc UpdateDevice(UpdateDeviceRequest) returns (DeviceResponse);

  rpc GetTransportObjectInfo(GetTransportObjectInfoRequest) returns (GetTransportObjectInfoResponse);

  rpc GetExportsTypes(google.protobuf.Empty) returns (GetExportTypesResponse);
  rpc GetExportStatuses(google.protobuf.Empty) returns (GetExportStatusesResponse);

  rpc CreateExport(CreateExportRequest) returns (ExportResponse);
  rpc UpdateExport(UpdateExportRequest) returns (ExportResponse);
  rpc GetExport(IdRequest) returns (ExportResponse);
  rpc GetAllExports(google.protobuf.Empty) returns (ExportsResponse);
  rpc DeleteExport(IdRequest) returns (ExportIdResponse);
  rpc ChangeExportState(ChangeExportStateRequest) returns (ChangeExportStateResponse);
  rpc GetExportEvents(GetExportsEventsRequest) returns (GetExportsEventsResponse);

  rpc CreateLane(CreateLaneRequest) returns (LaneResponse);
  rpc UpdateLane(UpdateLaneRequest) returns (LaneResponse);
  rpc GetLane(LaneRequest) returns (LaneResponse);
  rpc GetAllLanes(google.protobuf.Empty) returns (LanesResponse);
  rpc DeleteLane(LaneRequest) returns (IdResponse);
  rpc GetDirectionTypes(google.protobuf.Empty) returns (GetDirectionTypesResponse);
}
